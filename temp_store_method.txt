public function store(Request $request)
{
    $request->validate([
        'product_name' => 'required|string|max:255',
        'product_description' => 'nullable|string',
        'product_price' => 'required|numeric',
        'product_barcode' => 'nullable|string|max:100',
        'category_id' => 'nullable|exists:categories,id',
        'initial_stock' => 'nullable|integer|min:0',
    ]);

    // Create product
    $product = Products::create([
        'product_name' => $request->input('product_name'),
        'product_description' => $request->input('product_description'),
        'product_price' => $request->input('product_price'),
        'product_barcode' => $request->input('product_barcode'),
        'category_id' => $request->input('category_id'),
    ]);

    // Create initial stock entry if product was created
    if ($product) {
        DB::table('stocks')->insert([
            'product_id' => $product->id,
            'quantity' => $request->input('initial_stock', 0),
            'created_at' => now(),
            'updated_at' => now(),
        ]);
    }

    // Handle API requests
    if ($request->expectsJson() || $request->is('api/*')) {
        $product->load(['category', 'stock']);
        return response()->json([
            'success' => true,
            'message' => 'Product created successfully.',
            'product' => [
                'id' => $product->id,
                'name' => $product->product_name,
                'description' => $product->product_description,
                'price' => $product->product_price,
                'barcode' => $product->product_barcode,
                'stock' => $product->stock->quantity ?? 0,
                'category' => $product->category->category_name ?? 'Uncategorized',
                'category_id' => $product->category_id,
            ]
        ], 201);
    }

    // Handle web requests
    return redirect()->route('inventory.products')->with('success', 'Product created successfully.');
}
